{% extends "data_analysis/base.html" %}
{% load data_analysis_filters %}

{% block title %}Create Analysis - Data Analysis App{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <div>
            <h2 style="margin: 0;">Create Analysis</h2>
            {% if dataset %}
                <p style="color: #757575; margin: 0.5rem 0 0 0;">
                    Dataset: <a href="{% url 'data_analysis:dataset-detail' dataset.pk %}" style="color: inherit; text-decoration: underline;">{{ dataset.name }}</a>
                </p>
            {% endif %}
        </div>
        <div>
            {% if dataset %}
                <a href="{% url 'data_analysis:dataset-detail' dataset.pk %}" class="button secondary">
                    <span class="material-icons" style="vertical-align: middle; margin-right: 0.5rem;">dataset</span>
                    Back to Dataset
                </a>
            {% else %}
                <a href="{% url 'data_analysis:dataset-list' %}" class="button secondary">
                    <span class="material-icons" style="vertical-align: middle; margin-right: 0.5rem;">dataset</span>
                    View Datasets
                </a>
            {% endif %}
        </div>
    </div>

    {% if dataset %}
        <form method="post">
            {% csrf_token %}
            {{ form.dataset }}
            
            <div style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1rem;">Select Analysis Type</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                    {% for value, label in form.fields.analysis_type.choices %}
                        <div class="analysis-type-option" style="background-color: #f8f9fa; padding: 1.5rem; border-radius: 8px; border: 1px solid #e0e0e0;">
                            <div style="display: flex; align-items: flex-start; gap: 1rem;">
                                <div style="margin-top: 0.25rem;">
                                    <input type="radio" name="analysis_type" value="{{ value }}" id="id_analysis_type_{{ forloop.counter0 }}" 
                                           {% if form.analysis_type.value == value %}checked{% endif %} 
                                           class="form-check-input">
                                </div>
                                <div>
                                    <label for="id_analysis_type_{{ forloop.counter0 }}" style="font-weight: 500; margin-bottom: 0.5rem; display: block;">
                                        {{ label }}
                                    </label>
                                    <p style="color: #757575; margin: 0;">
                                        {{ form.fields.analysis_type.help_text|get_item:value }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <div style="text-align: right;">
                <button type="submit" class="button">
                    <span class="material-icons" style="vertical-align: middle; margin-right: 0.5rem;">analytics</span>
                    Create Analysis
                </button>
            </div>
        </form>
    {% else %}
        <div style="text-align: center; padding: 2rem; color: #757575;">
            <span class="material-icons" style="font-size: 3rem; margin-bottom: 1rem;">dataset</span>
            <p style="margin: 0;">Please select a dataset first.</p>
            <a href="{% url 'data_analysis:dataset-list' %}" class="button" style="margin-top: 1rem;">
                <span class="material-icons" style="vertical-align: middle; margin-right: 0.5rem;">dataset</span>
                View Datasets
            </a>
        </div>
    {% endif %}
</div>
{% endblock %} 